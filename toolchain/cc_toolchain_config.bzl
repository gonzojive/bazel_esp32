load(
    "@bazel_tools//tools/cpp:cc_toolchain_config_lib.bzl",
    "action_config",
    "artifact_name_pattern",
    "env_entry",
    "env_set",
    "feature",
    "feature_set",
    "flag_group",
    "flag_set",
    "make_variable",
    "tool",
    "tool_path",
    "variable_with_value",
    "with_feature_set",
)
load("@bazel_tools//tools/build_defs/cc:action_names.bzl", "ACTION_NAMES")

INCLUDE_FLAGS = [
    "-Iexternal/esp32_toolchain/cores/esp32",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/config",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/newlib/platform_include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/freertos/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/freertos/port/xtensa/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_hw_support/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_hw_support/include/soc",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_hw_support/port/esp32",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/heap/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/log/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/lwip/include/apps",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/lwip/include/apps/sntp",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/lwip/lwip/src/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/lwip/port/esp32/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/lwip/port/esp32/include/arch",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/soc/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/soc/esp32",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/soc/esp32/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/hal/esp32/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/hal/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_rom/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_rom/esp32",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_common/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_system/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_system/port/soc",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_system/port/public_compat",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp32/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/driver/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/driver/esp32/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_pm/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_ringbuf/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/efuse/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/efuse/esp32/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/xtensa/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/xtensa/esp32/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/vfs/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_wifi/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_wifi/esp32/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_event/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_netif/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_eth/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/tcpip_adapter/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/app_trace/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_timer/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/mbedtls/port/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/mbedtls/mbedtls/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/mbedtls/esp_crt_bundle/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/app_update/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/spi_flash/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/bootloader_support/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_ipc/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/nvs_flash/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/pthread/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_gdbstub/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_gdbstub/xtensa",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_gdbstub/esp32",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/espcoredump/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/espcoredump/include/port/xtensa",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/wpa_supplicant/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/wpa_supplicant/port/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/wpa_supplicant/include/esp_supplicant",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/perfmon/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/asio/asio/asio/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/asio/port/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/bt/common/osi/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/bt/include/esp32/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/bt/host/bluedroid/api/include/api",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/cbor/port/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/unity/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/unity/unity/src",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/cmock/CMock/src",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/coap/port/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/coap/port/include/coap",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/coap/libcoap/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/coap/libcoap/include/coap2",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/console",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/nghttp/port/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/nghttp/nghttp2/lib/includes",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-tls",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-tls/esp-tls-crypto",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_adc_cal/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_hid/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/tcp_transport/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_http_client/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_http_server/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_https_ota/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/protobuf-c/protobuf-c",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/protocomm/include/common",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/protocomm/include/security",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/protocomm/include/transports",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/mdns/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_local_ctrl/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/sdmmc/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_serial_slave_link/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_websocket_client/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/expat/expat/expat/lib",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/expat/port/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/wear_levelling/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/fatfs/diskio",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/fatfs/vfs",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/fatfs/src",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/freemodbus/common/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/idf_test/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/idf_test/include/esp32",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/jsmn/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/json/cJSON",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/libsodium/libsodium/src/libsodium/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/libsodium/port_include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/mqtt/esp-mqtt/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/openssl/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/spiffs/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/ulp/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/wifi_provisioning/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/button/button/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/json_parser",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/json_parser/jsmn/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/json_generator",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_schedule/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_rainmaker/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/qrcode/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/ws2812_led",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_littlefs/src",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp_littlefs/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/dotprod/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/support/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/hann/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/blackman/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/blackman_harris/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/blackman_nuttall/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/nuttall/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/flat_top/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/iir/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/fir/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/add/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/sub/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/mul/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/addc/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/mulc/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/sqrt/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/matrix/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/fft/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/dct/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/conv/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/common/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-face/face_detection/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-face/face_recognition/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-face/object_detection/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-face/image_util/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-face/pose_estimation/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp-face/lib/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp32-camera/driver/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/esp32-camera/conversions/include",
    "-Iexternal/esp32_toolchain/tools/sdk/esp32/include/fb_gfx/include",
    "-Iexternal/esp32_toolchain/cores/esp32",
    "-Iexternal/esp32_toolchain/variants/esp32",
]

COMMON_FLAGS = [
    "-DHAVE_CONFIG_H",
    "-DMBEDTLS_CONFIG_FILE=\"mbedtls/esp_config.h\"",
    "-DUNITY_INCLUDE_CONFIG_H",
    "-DWITH_POSIX",
    "-D_GNU_SOURCE",
    "-DIDF_VER=\"v4.4-dev-960-gcf457d412\"",
    "-DESP_PLATFORM",
    "-mlongcalls",
    "-Wno-frame-address",
    "-ffunction-sections",
    "-fdata-sections",
    "-Wno-error=unused-function",
    "-Wno-error=unused-variable",
    "-Wno-error=deprecated-declarations",
    "-Wno-unused-parameter",
    "-Wno-sign-compare",
    "-ggdb",
    "-O2",
    "-fstack-protector",
    "-fstrict-volatile-bitfields",
    "-Wno-error=unused-but-set-variable",
    "-MMD",
    "-c",
    "-DF_CPU=240000000L",
    "-DARDUINO=10607",
    "-DARDUINO_ESP32_DEV",
    "-DARDUINO_ARCH_ESP32",
    "-DARDUINO_BOARD=\"ESP32_DEV\"",
    "-DARDUINO_VARIANT=\"esp32\"",
    "-DESP32",
    "-DCORE_DEBUG_LEVEL=0",
    "-DARDUINO_RUNNING_CORE=1",
    "-DARDUINO_EVENT_RUNNING_CORE=1",
    "-DARDUINO_SERIAL_PORT=0",
]

def _impl(ctx):
    tool_paths = [
        tool_path(
            name = "gcc",
            path = "cc_wrapper.sh",
        ),
        tool_path(
            name = "ld",
            path = "xtensa-esp32-elf-ld",
        ),
        tool_path(
            name = "ar",
            path = "xtensa-esp32-elf-ar",
        ),
        tool_path(
            name = "cpp",
            path = "/bin/false",
        ),
        tool_path(
            name = "gcov",
            path = "/bin/false",
        ),
        tool_path(
            name = "nm",
            path = "/bin/false",
        ),
        tool_path(
            name = "objdump",
            path = "/bin/false",
        ),
        tool_path(
            name = "strip",
            path = "/bin/false",
        ),
    ]

    default_compile_flags_feature = feature(
        name = "default_compile_flags",
        enabled = True,
        flag_sets = [
            flag_set(
                actions = [
                    ACTION_NAMES.assemble,
                    ACTION_NAMES.preprocess_assemble,
                    ACTION_NAMES.linkstamp_compile,
                    ACTION_NAMES.cpp_compile,
                    ACTION_NAMES.cpp_header_parsing,
                    ACTION_NAMES.cpp_module_compile,
                    ACTION_NAMES.cpp_module_codegen,
                    ACTION_NAMES.lto_backend,
                    ACTION_NAMES.clif_match,
                ],
                flag_groups = [
                    flag_group(
                        flags = [
                            "-DCOMPILING_AS_CPP_NOT_C",
                            "-std=gnu++11",
                            "-fexceptions",
                            "-fno-rtti",
                        ] + COMMON_FLAGS + INCLUDE_FLAGS,
                    ),
                ],
            ),
        ],
    )

    default_c_compile_flags_feature = feature(
        name = "default_c_compile_flags",
        enabled = True,
        flag_sets = [
            flag_set(
                actions = [
                    ACTION_NAMES.c_compile,
                ],
                flag_groups = [
                    flag_group(
                        flags = [
                            "-DCOMPILING_AS_C_NOT_CPP",
                            "-std=gnu99",
                            "-Wno-old-style-declaration",
                        ] + COMMON_FLAGS + INCLUDE_FLAGS,
                    ),
                ],
            ),
        ],
    )

    all_link_actions = [
        ACTION_NAMES.cpp_link_executable,
        ACTION_NAMES.cpp_link_dynamic_library,
        ACTION_NAMES.cpp_link_nodeps_dynamic_library,
    ]

    default_link_flags_feature = feature(
        name = "default_link_flags",
        enabled = True,
        flag_sets = [
            flag_set(
                actions = all_link_actions,
                flag_groups = [
                    flag_group(
                        flags = [
                            "-Lexternal/esp32_toolchain/tools/sdk/esp32/lib",
                            "-Lexternal/esp32_toolchain/tools/sdk/esp32/ld",
                            "-T",
                            "esp32.rom.ld",
                            "-T",
                            "esp32.rom.api.ld",
                            "-T",
                            "esp32.rom.libgcc.ld",
                            "-T",
                            "esp32.rom.newlib-data.ld",
                            "-T",
                            "esp32.rom.syscalls.ld",
                            "-T",
                            "esp32_out.ld",
                            "-T",
                            "esp32.project.ld",
                            "-T",
                            "esp32.peripherals.ld",
                            "-mlongcalls",
                            "-Wno-frame-address",
                            "-Wl,--cref",
                            "-Wl,--gc-sections",
                            "-fno-rtti",
                            "-fno-lto",
                            "-Wl,--wrap=mbedtls_mpi_exp_mod",
                            "-u",
                            "esp_app_desc",
                            "-u",
                            "pthread_include_pthread_impl",
                            "-u",
                            "pthread_include_pthread_cond_impl",
                            "-u",
                            "pthread_include_pthread_local_storage_impl",
                            "-u",
                            "ld_include_panic_highint_hdl",
                            "-u",
                            "start_app",
                            "-u",
                            "start_app_other_cores",
                            "-u",
                            "vfs_include_syscalls_impl",
                            "-u",
                            "call_user_start_cpu0",
                            "-Wl,--undefined=uxTopUsedPriority",
                            "-u",
                            "app_main",
                            "-u",
                            "newlib_include_heap_impl",
                            "-u",
                            "newlib_include_syscalls_impl",
                            "-u",
                            "newlib_include_pthread_impl",
                            "-u",
                            "__cxa_guard_dummy",
                            "-DESP32",
                            "-DCORE_DEBUG_LEVEL=0",
                            "-DARDUINO_RUNNING_CORE=1",
                            "-DARDUINO_EVENT_RUNNING_CORE=1",
                            "-DARDUINO_SERIAL_PORT=0",
                            "-Wl,--start-group",
                            "-lapp_trace",
                            "-lapp_update",
                            "-lasio",
                            "-lbootloader_support",
                            "-lbt",
                            "-lbtdm_app",
                            "-lbutton",
                            "-lc",
                            "-lcbor",
                            "-lcmock",
                            "-lcoap",
                            "-lcoexist",
                            "-lconsole",
                            "-lcore",
                            "-lcxx",
                            "-ldetection",
                            "-ldetection_cat_face",
                            "-ldl",
                            "-ldriver",
                            "-lefuse",
                            "-lesp32",
                            "-lesp32-camera",
                            "-lesp_adc_cal",
                            "-lesp_common",
                            "-lespcoredump",
                            "-lesp-dsp",
                            "-lesp_eth",
                            "-lesp_event",
                            "-lesp-face",
                            "-lesp_gdbstub",
                            "-lesp_hid",
                            "-lesp_http_client",
                            "-lesp_http_server",
                            "-lesp_https_ota",
                            "-lesp_hw_support",
                            "-lesp_ipc",
                            "-lesp_littlefs",
                            "-lesp_local_ctrl",
                            "-lesp_netif",
                            "-lespnow",
                            "-lesp_pm",
                            "-lesp_rainmaker",
                            "-lesp_ringbuf",
                            "-lesp_rom",
                            "-lesp_schedule",
                            "-lesp_serial_slave_link",
                            "-lesp_system",
                            "-lesp_timer",
                            "-lesp-tls",
                            "-lesp_websocket_client",
                            "-lesp_wifi",
                            "-lexpat",
                            "-lfatfs",
                            "-lfb_gfx",
                            "-lfd",
                            "-lfr",
                            "-lfreemodbus",
                            "-lfreertos",
                            "-lgcc",
                            "-lgcov",
                            "-lhal",
                            "-lheap",
                            "-ljsmn",
                            "-ljson",
                            "-ljson_generator",
                            "-ljson_parser",
                            "-llibsodium",
                            "-llog",
                            "-llwip",
                            "-lm",
                            "-lmbedcrypto",
                            "-lmbedtls",
                            "-lmbedx509",
                            "-lmdns",
                            "-lmesh",
                            "-lmqtt",
                            "-lnet80211",
                            "-lnewlib",
                            "-lnghttp",
                            "-lnvs_flash",
                            "-lopenssl",
                            "-lpe",
                            "-lperfmon",
                            "-lphy",
                            "-lpp",
                            "-lprotobuf-c",
                            "-lprotocomm",
                            "-lpthread",
                            "-lqrcode",
                            "-lrtc",
                            "-lsdmmc",
                            "-lsmartconfig",
                            "-lsoc",
                            "-lspiffs",
                            "-lspi_flash",
                            "-lstdc++",
                            "-ltcpip_adapter",
                            "-ltcp_transport",
                            "-lulp",
                            "-lunity",
                            "-lvfs",
                            "-lwapi",
                            "-lwear_levelling",
                            "-lwifi_provisioning",
                            "-lwpa_supplicant",
                            "-lws2812_led",
                            "-lxtensa",
                            "-lxt_hal",
                            "-Wl,--end-group",
                            "-Wl,-EL",
                        ],
                    ),
                ],
            ),
        ],
    )

    features = [
        default_compile_flags_feature,
        default_c_compile_flags_feature,
        default_link_flags_feature,
    ]

    return cc_common.create_cc_toolchain_config_info(
        ctx = ctx,
        cxx_builtin_include_directories = [
            "external/xtensa_esp32_elf_linux64/xtensa-esp32-elf/sys-include",
            "external/xtensa_esp32_elf_linux64/xtensa-esp32-elf/include/c++/8.4.0",
            "external/xtensa_esp32_elf_linux64/lib/gcc/xtensa-esp32-elf/8.4.0/include-fixed",
            "external/xtensa_esp32_elf_linux64/lib/gcc/xtensa-esp32-elf/8.4.0/include",
            "external/esp32_toolchain/cores/esp32",
            "external/esp32_toolchain/tools/sdk/esp32/include/config",
            "external/esp32_toolchain/tools/sdk/esp32/include/newlib/platform_include",
            "external/esp32_toolchain/tools/sdk/esp32/include/freertos/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/freertos/port/xtensa/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_hw_support/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_hw_support/include/soc",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_hw_support/port/esp32",
            "external/esp32_toolchain/tools/sdk/esp32/include/heap/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/log/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/lwip/include/apps",
            "external/esp32_toolchain/tools/sdk/esp32/include/lwip/include/apps/sntp",
            "external/esp32_toolchain/tools/sdk/esp32/include/lwip/lwip/src/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/lwip/port/esp32/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/lwip/port/esp32/include/arch",
            "external/esp32_toolchain/tools/sdk/esp32/include/soc/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/soc/esp32",
            "external/esp32_toolchain/tools/sdk/esp32/include/soc/esp32/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/hal/esp32/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/hal/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_rom/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_rom/esp32",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_common/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_system/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_system/port/soc",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_system/port/public_compat",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp32/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/driver/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/driver/esp32/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_pm/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_ringbuf/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/efuse/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/efuse/esp32/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/xtensa/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/xtensa/esp32/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/vfs/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_wifi/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_wifi/esp32/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_event/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_netif/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_eth/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/tcpip_adapter/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/app_trace/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_timer/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/mbedtls/port/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/mbedtls/mbedtls/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/mbedtls/esp_crt_bundle/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/app_update/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/spi_flash/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/bootloader_support/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_ipc/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/nvs_flash/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/pthread/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_gdbstub/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_gdbstub/xtensa",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_gdbstub/esp32",
            "external/esp32_toolchain/tools/sdk/esp32/include/espcoredump/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/espcoredump/include/port/xtensa",
            "external/esp32_toolchain/tools/sdk/esp32/include/wpa_supplicant/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/wpa_supplicant/port/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/wpa_supplicant/include/esp_supplicant",
            "external/esp32_toolchain/tools/sdk/esp32/include/perfmon/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/asio/asio/asio/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/asio/port/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/bt/common/osi/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/bt/include/esp32/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/bt/host/bluedroid/api/include/api",
            "external/esp32_toolchain/tools/sdk/esp32/include/cbor/port/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/unity/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/unity/unity/src",
            "external/esp32_toolchain/tools/sdk/esp32/include/cmock/CMock/src",
            "external/esp32_toolchain/tools/sdk/esp32/include/coap/port/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/coap/port/include/coap",
            "external/esp32_toolchain/tools/sdk/esp32/include/coap/libcoap/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/coap/libcoap/include/coap2",
            "external/esp32_toolchain/tools/sdk/esp32/include/console",
            "external/esp32_toolchain/tools/sdk/esp32/include/nghttp/port/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/nghttp/nghttp2/lib/includes",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-tls",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-tls/esp-tls-crypto",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_adc_cal/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_hid/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/tcp_transport/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_http_client/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_http_server/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_https_ota/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/protobuf-c/protobuf-c",
            "external/esp32_toolchain/tools/sdk/esp32/include/protocomm/include/common",
            "external/esp32_toolchain/tools/sdk/esp32/include/protocomm/include/security",
            "external/esp32_toolchain/tools/sdk/esp32/include/protocomm/include/transports",
            "external/esp32_toolchain/tools/sdk/esp32/include/mdns/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_local_ctrl/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/sdmmc/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_serial_slave_link/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_websocket_client/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/expat/expat/expat/lib",
            "external/esp32_toolchain/tools/sdk/esp32/include/expat/port/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/wear_levelling/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/fatfs/diskio",
            "external/esp32_toolchain/tools/sdk/esp32/include/fatfs/vfs",
            "external/esp32_toolchain/tools/sdk/esp32/include/fatfs/src",
            "external/esp32_toolchain/tools/sdk/esp32/include/freemodbus/common/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/idf_test/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/idf_test/include/esp32",
            "external/esp32_toolchain/tools/sdk/esp32/include/jsmn/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/json/cJSON",
            "external/esp32_toolchain/tools/sdk/esp32/include/libsodium/libsodium/src/libsodium/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/libsodium/port_include",
            "external/esp32_toolchain/tools/sdk/esp32/include/mqtt/esp-mqtt/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/openssl/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/spiffs/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/ulp/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/wifi_provisioning/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/button/button/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/json_parser",
            "external/esp32_toolchain/tools/sdk/esp32/include/json_parser/jsmn/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/json_generator",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_schedule/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_rainmaker/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/qrcode/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/ws2812_led",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_littlefs/src",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp_littlefs/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/dotprod/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/support/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/hann/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/blackman/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/blackman_harris/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/blackman_nuttall/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/nuttall/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/windows/flat_top/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/iir/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/fir/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/add/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/sub/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/mul/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/addc/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/mulc/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/math/sqrt/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/matrix/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/fft/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/dct/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/conv/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-dsp/modules/common/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-face/face_detection/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-face/face_recognition/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-face/object_detection/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-face/image_util/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-face/pose_estimation/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp-face/lib/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp32-camera/driver/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/esp32-camera/conversions/include",
            "external/esp32_toolchain/tools/sdk/esp32/include/fb_gfx/include",
            "external/esp32_toolchain/cores/esp32",
            "external/esp32_toolchain/variants/esp32",
        ],
        features = features,
        toolchain_identifier = "xtensa-toolchain",
        host_system_name = "local",
        target_system_name = "local",
        target_cpu = "xtensa",
        target_libc = "unknown",
        compiler = "cpp",
        abi_version = "unknown",
        abi_libc_version = "unknown",
        tool_paths = tool_paths,
    )

cc_toolchain_config = rule(
    implementation = _impl,
    attrs = {},
    provides = [CcToolchainConfigInfo],
)
